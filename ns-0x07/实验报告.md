## SQL注入 Webshell

整个实验根据在线教程的流程走就能顺利进行√ WebGoat上也包含一些SQL注入实验√

### 环境配置
虚拟机1（受害者/服务器） Debian SQL - Host-only网卡

虚拟机2（攻击者） Kali - Host-only网卡

### 端口/系统信息采集

查看网卡信息 `ifconfig`

![](ifconfig.png)

扫描网段 `netdiscover -r 192.168.1.0/24`

![](netdiscover.png)

获取服务器开放端口及系统信息

![](nmap-A.png)

尝试远程连接
- 这里的80端口其实是开启的，但是始终无法连上

![](telnet.png)

再次进行尝试
- 端口协议不匹配
    - `telnet` 明文传输数据
    - `ssh` 加密

![](nmap-sT.png)

使用 `nc` 获得的连接结果相同

![](nc.png)

### 网站信息采集

访问目标网址

![](index.png)


对网页源码进行分析，这里令人感兴趣的是各个链接，显然后台使用的是php

![](pagesouce.png)

尝试访问链接

![](all.png)

![](admin.png)

![](cthulhu.png)

猜测其他图片，发现错误信息返回的还不少

![](a.png)

暴力检测 Web 服务器上的目录和页面（使用 wfuzz）

![](wfuzz.png)

```bash
wfuzz -c -z file,wordlist/general/big.txt --hc 404 http://192.168.1.101/FUZZ
# -c    高亮
# -z file,wordlist/general/big.txt  爆破字典
# --hc 404  忽略404响应
# http://192.168.1.101/FUZZ 用字典值替换FUZZ
```

![](wfuzz_result.png)

### SQL注入

#### 测试

对 cat.php 进行SQL注入测试，显示了所有图片，说明存在漏洞

![](cat.png)

使用 UNION ，枚举字段数（列数）

![](em1.png)

![](em2.png)

使用ORDER BY ，枚举字段数（列数）

![](order1.png)

![](order2.png)


#### 信息获取

尝试后发现只有在UNION的第二列才能显示信息

数据库版本信息

![](version.png)

当前用户信息

![](user.png)

当前使用的数据库信息

![](database.png)

MYSQL5 开始包含数据库、表、列的[元信息 (meta information)](https://www.google.com/search?q=mysql+meta+information&oq=mysql+meta+information)

所有的表名称

![](table.png)

所有的列名称

![](column.png)

表和对应的列名称

![](table_column.png)

查找是否有密码字段

![](pass.png)

 users 表信息

![](users.png)

### 登录后台

在线破解MD5

![](online.png)

使用john破解
- 查看支持的模式，准备必要的密码文件

![](formats.png)

找一个密码字典尝试破解

![](lst.png)

未果，尝试使用Kali内置的其他字典
- 截图前已爆破成功，这里就直接进行展示

![](txt.png)

获取用户名、密码后，尝试登录后台
- 这里的 `new.php` 可以用来上传Webshell

![](administration.png)

### Webshell

构建Webshell文件，执行 GET 请求中 cmd 参数的值 

![](webshell.png)

尝试上传php文件

![](upload1.png)

上传失败，说明该网站禁止了直接上传php

![](nophp.png)

修改文件名，尝试绕过检测

![](upload2.png)

上传成功，点击 Home 查看最新图片

![](success.png)

测试 Webshell

![](ws_test.png)

系统用户信息

![](ws_passwd.png)

系统版本信息

![](ws_uname.png)

列出目录下的文件

![](ws_ls.png)

php信息

![](ws_php.png)

php配置文件中特定的设置

![](ws_display.png)

### 参阅
- [模糊测试 Fuzz ](https://en.wikipedia.org/wiki/Fuzzing)
- [From SQL Injection to Shell](https://pentesterlab.com/exercises/from_sqli_to_shell/course)
- [使用 /etc/passwd 文件](https://www.ibm.com/support/knowledgecenter/zh/ssw_aix_71/com.ibm.aix.security/passwords_etc_passwd_file.htm)